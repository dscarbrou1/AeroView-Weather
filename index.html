<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AeroView Weather App</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for background and font */
        body {
            font-family: 'Inter', sans-serif;
            /* Fallback/Initial Gradient (will be overwritten by image) */
            background: linear-gradient(135deg, #e0f2fe 0%, #d1e5ff 100%); 
            /* New properties for dynamic image background */
            background-size: cover;
            background-attachment: fixed; 
            background-position: center;
            transition: background-image 1s ease-in-out;
            
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        /* Increased max width for more content space */
        #app {
            max-width: 48rem; /* Increased from max-w-xl (36rem) to 48rem */
            width: 95%; /* Use 95% of screen width up to max-width */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            height: 8px; /* Height for horizontal scrollbar */
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #9ca3af;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-track {
            background: #e5e7eb;
        }
        /* Style for the active unit button */
        .unit-active {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.5), 0 2px 4px -2px rgba(59, 130, 246, 0.5); /* glow effect */
        }
        .unit-inactive {
            background-color: #e5e7eb; /* gray-200 */
            color: #4b5563; /* gray-600 */
        }
        /* History Item Focus Override */
        #cityInput:focus + #historyContainer > #historyDisplay {
            display: block;
        }
        /* Spinner animation */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            animation: spin 1s linear infinite;
        }

        /* Error Shake Animation for the Search Button */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        .error-shake {
            animation: shake 0.5s ease-in-out;
        }

        /* Modal Backdrop */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }

        /* --- IMMERSIVE ANIMATION STYLES --- */

        /* Animation for sun rotation */
        @keyframes sun-rotate {
            to { transform: rotate(360deg); }
        }
        /* Animation for gentle cloud movement */
        @keyframes cloud-move {
            0% { transform: translateX(0); }
            50% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }
        /* Animation for raindrops falling */
        @keyframes rain-fall {
            0% { transform: translateY(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(100%); opacity: 0; }
        }
        /* Animation for snow falling */
        @keyframes snow-fall {
            0% { transform: translate(0, -10px); opacity: 0; }
            100% { transform: translate(10px, 10px); opacity: 1; }
        }

        /* Applying animations */
        .animated-sun {
            animation: sun-rotate 12s linear infinite;
            transform-origin: 50% 50%;
        }
        .animated-cloud {
            animation: cloud-move 6s ease-in-out infinite alternate;
        }
        .animated-rain {
            animation: rain-fall 1s linear infinite;
        }
        .animated-snow {
            animation: snow-fall 2s linear infinite;
        }
        
        /* Hourly Scroll Container */
        .hourly-scroll {
            overflow-x: auto;
            white-space: nowrap;
            padding-bottom: 0.5rem; /* Space for scrollbar */
        }
        .hourly-card {
            display: inline-block;
            width: 6rem; /* Fixed width for each hourly card */
            min-width: 6rem;
            margin-right: 0.5rem;
            vertical-align: top;
        }

        /* Styling the date selector buttons */
        .date-selector-active {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.5);
        }
    </style>
</head>
<body>

    <div id="app" class="bg-white/90 p-6 md:p-8 rounded-3xl shadow-2xl transition-all duration-300">
        
        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-3xl font-extrabold text-gray-800">AeroView</h1>
            <p class="text-sm text-gray-500 mt-1">Check the current conditions anywhere in the world.</p>
        </header>
        
        <!-- Severe Weather Alert Banner (Highest Priority) -->
        <div id="alertBanner" class="hidden p-3 mb-4 rounded-lg bg-red-100 border border-red-400 text-red-700 font-semibold flex items-center shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-1-12a1 1 0 102 0V9a1 1 0 10-2 0V6zm0 5a1 1 0 102 0 1 1 0 00-2 0z" clip-rule="evenodd" />
            </svg>
            <span id="alertContent"></span>
        </div>

        <!-- Input Section -->
        <div class="flex space-x-3 mb-4">
            <div class="relative flex-grow">
                <input type="text" id="cityInput" placeholder="Enter city name or use location..." 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150 shadow-inner">
                <!-- Refresh Button (Hidden until successful search) -->
                <button id="refreshButton" 
                        class="absolute right-0 top-0 h-full w-12 bg-blue-500 hover:bg-blue-600 text-white rounded-r-lg shadow-md transition duration-150 flex items-center justify-center"
                        style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v1h2a1 1 0 011 1v2a1 1 0 01-1 1H5v2h2a1 1 0 011 1v2a1 1 0 01-1 1H5v1a1 1 0 01-2 0v-1H2a1 1 0 01-1-1v-2a1 1 0 011-1h1V8H2a1 1 0 01-1-1V5a1 1 0 011-1h1V3a1 1 0 011-1zm6.5 7.728l3.182-3.182a4 4 0 00-5.657-5.657L6.818 3.343a6 6 0 118.485 8.485l-3.182 3.182a1 1 0 01-1.414-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
            <!-- Search Button (Visible initially, toggles with Refresh) -->
            <button id="searchButton" 
                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition duration-150 transform hover:scale-105 active:scale-95">
                Search
            </button>
        </div>

        <!-- Search History List/Suggestions Dropdown -->
        <div id="historyContainer" class="relative">
            <div id="historyDisplay" 
                 class="absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-xl max-h-48 overflow-y-auto mt-[-10px] hidden">
                <div id="historyHeader" class="flex justify-between items-center p-2 border-b text-gray-500 text-xs font-semibold">
                    <span id="dropdownTitle">Recent Searches</span>
                    <button id="clearHistoryBtn" class="text-red-500 hover:text-red-700 font-bold px-2 py-1 rounded transition duration-150" title="Clear All History">
                        Clear
                    </button>
                </div>
                <div id="dropdownList">
                    <!-- Suggestions or History items injected here -->
                </div>
            </div>
        </div>

        <!-- Unit and Detail Toggles Container -->
        <div class="flex justify-center flex-wrap gap-x-6 gap-y-3 mb-6 mt-4">
            <!-- Unit Toggle -->
            <div id="unitToggle" class="flex p-1 bg-gray-200 rounded-lg shadow-inner">
                <button id="celsiusBtn" class="px-3 py-1 rounded-md text-sm font-bold transition">°C</button>
                <button id="fahrenheitBtn" class="px-3 py-1 rounded-md text-sm font-bold transition">°F</button>
            </div>

            <!-- Basic / Advanced Toggle -->
            <div id="detailToggle" class="flex p-1 bg-gray-200 rounded-lg shadow-inner">
                <button id="basicBtn" class="px-3 py-1 rounded-md text-sm font-bold transition">Basic</button>
                <button id="advancedBtn" class="px-3 py-1 rounded-md text-sm font-bold transition">Advanced</button>
            </div>
            
            <!-- 3D Map View -->
            <button id="mapBtn" class="text-sm font-semibold text-blue-600 hover:text-blue-800 transition transform hover:scale-105">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-1-12a1 1 0 102 0V9a1 1 0 10-2 0V6zm0 5a1 1 0 102 0 1 1 0 00-2 0z" clip-rule="evenodd" />
                </svg>
                View 3D Map
            </button>
        </div>

        <!-- Message Area (Errors/Information) -->
        <div id="messageArea" class="text-center text-red-500 font-medium mb-4" style="display: none;"></div>
        
        <!-- AI INSIGHT CARD -->
        <div id="insightCard" class="hidden p-4 mb-6 bg-white rounded-xl shadow-lg border-l-4 border-blue-500">
            <h3 class="text-lg font-bold text-gray-800 mb-2 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M5.5 10a.5.5 0 01.5-.5h2a.5.5 0 010 1H6a.5.5 0 01-.5-.5zm.5 2a.5.5 0 000 1h2a.5.5 0 000-1H6a.5.5 0 00-.5.5zm10-5a.5.5 0 01.5-.5h2a.5.5 0 010 1h-2a.5.5 0 01-.5-.5zM16 8a.5.5 0 000 1h2a.5.5 0 000-1h-2z" />
                    <path fill-rule="evenodd" d="M18.442 8.796a4.43 4.43 0 011.025.267 1 1 0 01.533.888v.175a1 1 0 01-.225.641l-2.023 2.768a1 1 0 01-.98.375h-2.128a1 1 0 01-.914-.582 1 1 0 01.196-.924c.036-.04.07-.08.106-.12l1.62-1.74a1 1 0 00-.773-1.614h-3.414l.001 2.5a1 1 0 01-1 1H5a1 1 0 01-1-1v-2.5H.5a.5.5 0 010-1h3.5v-2.5a1 1 0 011-1h6.414a1 1 0 00.773-1.614l-1.62-1.74a1 1 0 01-.196-.924 1 1 0 01.914-.582h2.128a1 1 0 01.98.375l2.023 2.768a1 1 0 01.225.641v.175a.5.5 0 01-.533.488zM15 11h-2v2h2v-2zM7 11H5v2h2v-2z" clip-rule="evenodd"/>
                </svg>
                AeroView Insight
            </h3>
            <div id="insightContent" class="text-sm text-gray-600 italic">
                <!-- AI generated text goes here -->
            </div>
            <div id="insightLoading" class="text-sm text-gray-500 mt-2 italic flex items-center">
                <svg class="spinner h-4 w-4 mr-1 text-blue-500" viewBox="0 0 50 50">
                    <circle class="path" cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="5" style="stroke-dasharray: 80, 100; opacity: 0.7;"></circle>
                </svg>
                Generating AI summary...
            </div>
        </div>
        <!-- END AI INSIGHT CARD -->

        
        <!-- Loading Skeleton -->
        <div id="loadingSkeleton" class="hidden text-center p-6 bg-gray-100 rounded-3xl shadow-md transition-all duration-300">
            <div class="flex flex-col items-center">
                <svg class="spinner h-8 w-8 text-blue-500 mb-4" viewBox="0 0 50 50">
                    <circle class="path" cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="5" style="stroke-dasharray: 80, 100; opacity: 0.7;"></circle>
                </svg>
                <div class="h-4 bg-gray-300 rounded w-1/2 mb-4 animate-pulse"></div>
                <div class="h-24 bg-gray-300 rounded-lg w-full mb-4 animate-pulse"></div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 w-full">
                    <div class="h-8 bg-gray-300 rounded animate-pulse"></div>
                    <div class="h-8 bg-gray-300 rounded animate-pulse"></div>
                    <div class="h-8 bg-gray-300 rounded animate-pulse"></div>
                    <div class="h-8 bg-gray-300 rounded animate-pulse"></div>
                </div>
            </div>
        </div>

        <!-- Initial/Welcome Content -->
        <div id="welcomeState" class="text-center p-6 bg-white rounded-3xl border border-gray-200 shadow-lg">
            <h2 class="text-xl font-bold text-gray-800 mb-2">Welcome to AeroView!</h2>
            <p class="text-gray-600 mb-4">Start by searching for a city, or grant location access to see your local weather.</p>
            <p class="text-sm text-blue-500 font-semibold flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                </svg>
                Try searching "London, UK" or "Dallas, TX"!
            </p>
        </div>
        
        <!-- Current Weather Card Display -->
        <div id="weatherDisplay" class="hidden text-center p-6 text-white rounded-3xl shadow-xl transform transition-all duration-500 scale-100 hover:scale-[1.02]">
            <!-- Current weather content will be injected here -->
        </div>

        <!-- Hourly Forecast Section -->
        <div id="hourlyForecastSection" class="hidden mt-6">
            <h3 class="text-xl font-bold text-gray-800 mb-3 text-center border-b pb-2">Hourly Forecast (Next 15 Hours)</h3>
            <div id="hourlyDisplay" class="hourly-scroll flex overflow-x-auto mt-4">
                <!-- Hourly forecast cards injected here -->
            </div>
        </div>

        <!-- 5-Day Forecast Section -->
        <div id="forecastSection" class="hidden mt-6">
            <h3 class="text-xl font-bold text-gray-800 mb-3 text-center border-b pb-2">5-Day Forecast</h3>
            <div id="forecastDisplay" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3">
                <!-- Forecast cards will be injected here -->
            </div>
        </div>

        <!-- App Footer -->
        <footer class="mt-6 text-center text-sm text-gray-400">
            <button id="aboutBtn" class="hover:text-gray-600 transition underline">About this App</button>
        </footer>
    </div>
    
    <!-- About Modal -->
    <div id="aboutModal" class="modal-backdrop hidden">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm transform transition-all duration-300 scale-100">
            <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">About AeroView</h3>
            <p class="text-gray-700 mb-3">
                This modern web application was developed by you, the creator, as a comprehensive coding project.
            </p>
            <p class="text-gray-700 mb-4">
                Weather data is powered by the **OpenWeatherMap API**. AI Insights are generated by the **Gemini API**.
            </p>
            <button id="closeModalBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg transition">
                Close
            </button>
        </div>
    </div>


    <script>
        // --- API CONFIGURATION ---
        const OPENWEATHER_API_KEY = "9fcf1e73c7dc66afb1e248c5ef3bdbb3"; 
        const CURRENT_WEATHER_URL = "https://api.openweathermap.org/data/2.5/weather";
        const FORECAST_URL = "https://api.openweathermap.org/data/2.5/forecast";
        const ALERTS_URL = "https://api.openweathermap.org/data/2.5/onecall";
        const AQI_URL = "https://api.openweathermap.org/data/2.5/air_pollution";
        const ICON_URL = "https://openweathermap.org/img/wn/";
        // Base URL for dynamic image search (fallback)
        const CITY_IMAGE_BASE = "https://source.unsplash.com/random/1600x900/?";
        const GEMINI_API_KEY = "AIzaSyDraNdjH386L-xPRwPD7VDZejiQPfI_7BM"; // User's key
        const GEMINI_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=" + GEMINI_API_KEY;

        
        // --- STATIC CITY LIST FOR SUGGESTIONS (Restored pre-7-continent list) ---
        const CITY_LIST = [
            // North America
            "New York, NY", "Los Angeles, CA", "Chicago, IL", "Houston, TX", "Philadelphia, PA", "Phoenix, AZ", "San Antonio, TX",
            "San Diego, CA", "Dallas, TX", "San Jose, CA", "Austin, TX", "Jacksonville, FL", "Fort Worth, TX",
            "Columbus, OH", "Charlotte, NC", "Indianapolis, IN", "San Francisco, CA", "Seattle, WA", 
            "Denver, CO", "Las Vegas, NV", "Miami, FL", "Boston, MA", "Atlanta, GA", "Detroit, MI",
            "Minneapolis, MN", "Portland, OR", "Baltimore, MD", "Milwaukee, WI", "Nashville, TN",
            "Reno, NV", "Mount Charleston, NV", "Birmingham, AL", "Washington, DC",
            // States (for search clarity)
            "California, US", "Texas, US", "Florida, US", "Illinois, US", "Nevada, US", "Michigan, US",
            // Major Global
            "London, UK", "Paris, FR", "Tokyo, JP", "Sydney, AU", "Dubai, AE", "Rome, IT", "Berlin, DE", 
            "Moscow, RU", "Beijing, CN", "Cairo, EG", "Rio de Janeiro, BR", "Mexico City, MX", "Toronto, CA", 
            "Vancouver, CA", "Mumbai, IN", "Bangkok, TH", "Seoul, KR", "Madrid, ES", "Barcelona, ES", 
            "Amsterdam, NL", "Stockholm, SE", "Oslo, NO", "Los Remedios de Michoacan, MX"
        ];
        
        // --- STATIC IMAGE MAPPING (Guaranteed City Images) ---
        const STATIC_CITY_IMAGES = {
            'NEW YORK': 'https://images.unsplash.com/photo-1546467005-0e10b240590a?q=80&w=1400&h=900&fit=crop&cs=tinysrgb',
            'LONDON': 'https://images.unsplash.com/photo-1533929780004-945624128521?q=80&w=1400&h=900&fit=crop&cs=tinysrgb',
            'PARIS': 'https://images.unsplash.com/photo-1502602898624-ad4b2a8d5811?q=80&w=1400&h=900&fit=crop&cs=tinysrgb',
            'TOKYO': 'https://images.unsplash.com/photo-1540679776092-d96a60391d1a?q=80&w=1400&h=900&fit=crop&cs=tinysrgb',
            'SYDNEY': 'https://images.unsplash.com/photo-1582260656515-f5be870c538a?q=80&w=1400&h=900&fit=crop&cs=tinysrgb',
            'DUBAI': 'https://images.unsplash.com/photo-1512495679313-264639902633?q=80&w=1400&h=900&fit=crop&cs=tinysrgb',
            'LAS VEGAS': 'https://images.unsplash.com/photo-1550503046-e5c9a444d47c?q=80&w=1400&h=900&fit=crop&cs=tinysrgb',
        };

        // --- STATE MAP FOR US CITIES ---
        const US_STATE_MAP = {
            'AL': 'AL', 'AK': 'AK', 'AZ': 'AZ', 'AR': 'AR', 'CA': 'CA', 'CO': 'CO', 'CT': 'CT', 'DE': 'DE', 'DC': 'DC', 'FL': 'FL', 'GA': 'GA', 'HI': 'HI', 'ID': 'ID', 'IL': 'IL', 'IN': 'IN', 'IA': 'IA', 'KS': 'KS', 'KY': 'KY', 'LA': 'LA', 'ME': 'ME', 'MD': 'MD', 'MA': 'MA', 'MI': 'MI', 'MN': 'MN', 'MS








